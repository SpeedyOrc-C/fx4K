# fx4K

**简体中文** - [English](README_en.md)

## 简介

运行在卡西欧 fx-9750 与 fx-9860 系列图形计算器上的4K（四按键）下落式音游。

## 项目开始前可行性的考虑与实现的难度

### 屏幕刷新率

这个计算器的屏幕刷新率可以非常的高，但由于液晶显示屏在显示上会有延迟而造成残影，有可能会让读谱产生困难。另外，音游需要精确地计时，调用系统时间太麻烦（具体方法没有在官方文档给出，而民间摸索出来了调用函数的魔法地址），而且只能精确到秒。因此在 fx4K 中的帧率为 40 帧每秒，一帧长度为 25 毫秒。通过 `fxlib.h` 中的延迟函数实现。

### 玩法

由于硬件本身的限制，铺面应该只能包含 click（点按）和 hold（长按）。对于长按，因为液晶屏的延迟，**不会有尾判**。

### 铺面来源

由于鄙人不会写铺子，也从来没有参与过音游的开发，可以看到有一个 Python 脚本，用于把 Malody 的铺面转换成 fx4K 的铺面。由于变速对于鄙人来说难以实现，将会以铺面最初的 BPM 应用到全曲。BPM 将会强制转换为整数。

## 二进制结构

### 铺面

| Byte\(s\) | Length | Meaning            |
| :-------- | :----- | :----------------- |
| `00~1F`   | 16     | song title string  |
| `20~3F`   | 16     | song artist string |
| `40,41`   | 2      | BPM                |
| `42,43`   | 2      | note count         |
| `44,45`   | 2      | song length        |
| `46~4F`   | 12     | LEAVE BLANK        |

### 音符

| Byte\(s\) | Length | Meaning                    |
| :-------- | :----- | :------------------------- |
| `00,01`   | 2      | note start time            |
| `02,03`   | 2      | note end time \(optional\) |
| `04`      | 1      | note type (`C` or `H`)     |
| `05`      | 1      | column                     |
| `06,07`   | 2      | LEAVE BLANK                |
